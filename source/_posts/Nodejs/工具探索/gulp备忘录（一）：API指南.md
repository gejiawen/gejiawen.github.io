postid: 'gulp-reminder-1-api'
title: gulpå¤‡å¿˜å½•ï¼ˆä¸€ï¼‰ï¼šAPIæŒ‡å—
categories: [Nodejs]
tags: [gulp, nodejs, æ¼«æ¸¸NodeJSç³»åˆ—]
date: 2015-12-05 22:58:55

---

# å‰è¨€

è‡ªä»[gulp](http://gulpjs.com/)é¢ä¸–ä»¥åï¼Œæˆ‘å°±æŠ›å¼ƒäº†[Grunt](http://gruntjs.com/)åŠ å…¥äº†gulpçš„é˜µè¥ã€‚ä»æ˜“ç”¨æ€§ä»¥åŠæ€§èƒ½æ–¹é¢æ¥è¯´ï¼Œæ— ç–‘gulpæ›´å…·ä¼˜åŠ¿ã€‚å…·ä½“çš„å¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« [gulp vs. grunt](http://gejiawen.github.io/2015/01/09/gulp-vs-grunt/)ã€‚

å¯ä»¥è¯´ï¼Œæˆ‘å¾ˆæ—©å°±å¼€å§‹ä½¿ç”¨gulpäº†ï¼Œé‚£ä¸ºä½•ä¼šæœ‰è¿™å‡ ç¯‡gulpçš„ç›¸å…³æ–‡ç« å‘¢ï¼Ÿæ˜¯å› ä¸ºå‘ç°æˆ‘åœ¨ä½¿ç”¨gulpçš„æ—¶å€™ï¼Œä»ç„¶å¤„äºä¸€ä¸ª**ä»…ä»…ä¼šç”¨**çš„å±‚é¢ä¸Šï¼Œå½“éœ€è¦ä½¿ç”¨ä¸€äº›æ’ä»¶æ—¶ï¼Œå¾€å¾€æ˜¯åœ¨[npm](https://www.npmjs.com/)æ‰¾åˆ°å¯¹åº”çš„æ’ä»¶ï¼Œç„¶åç…§ç€exampleæŠ„ä¸€éï¼Œå¯¹gulpçš„æœ‰äº›ç‰¹æ€§è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚æ‰€ä»¥æˆ‘è§‰å¾—å¾ˆæœ‰å¿…è¦å†™ä¸€äº›ä¸œè¥¿æ¥æ·±åº¦å­¦ä¹ ä¸€ä¸‹gulpã€‚

# ä»‹ç»

é¦–å…ˆæ¥ä»‹ç»ä¸€ä¸‹gulpã€‚

gulpæ˜¯ä¸€æ¬¾å‰ç«¯æ„å»ºå·¥å…·ï¼Œå®ƒå°†æ„å»ºæ“ä½œæŠ½è±¡æˆä¸€ç³»åˆ—çš„ä»»åŠ¡ã€‚åšçš„äº‹æƒ…ä¸gruntæ˜¯ä¸€æ ·çš„ã€‚ä¸è¿‡å®ƒä¿¡å¥‰çš„åŸåˆ™æ˜¯**ä»£ç ä¼˜äºé…ç½®**ï¼ŒåŸºäºNode.jsä¸­çš„streamæ¥æ“ä½œæ–‡ä»¶ã€‚

## å®‰è£…

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥å®‰è£…gulpï¼Œ

```bash
$ npm install -g gulp
```

å®‰è£…æˆåŠŸä¹‹åä½ å°±å¯ä»¥ç›´æ¥åœ¨ä»»ä½•è·¯å¾„ä¸Šä½¿ç”¨`gulp`å‘½ä»¤äº†ã€‚ä¸è¿‡åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨gulpæ—¶ï¼Œå¾€å¾€éœ€è¦å®‰è£…ä¸€ä¸ªlocalç‰ˆæœ¬çš„gulpï¼Œ

```bash
$ npm install gulp --save-dev
```

é‡‡ç”¨`--save-dev`å°†gulpå†™è¿›`package.json`çš„`devDependencies`ä¾èµ–ä¸­ã€‚

è‡³äºä¸ºä½•å…¨å±€å®‰è£…gulpä¹‹åè¿˜éœ€è¦åœ¨é¡¹ç›®ä¸­å®‰è£…gulpï¼Œå¯ä»¥å‚è§stackoverflowä¸Šçš„é—®é¢˜[why-do-we-need-to-install-gulp-globally-and-locally](http://stackoverflow.com/questions/22115400/why-do-we-need-to-install-gulp-globally-and-locally)ã€‚åŸºæœ¬ä¸Šè¿™ä¹ˆåšçš„åŸå› æ˜¯ä¸ºäº†çµæ´»çš„å»ä½¿ç”¨gulpï¼Œå¦‚æœå®åœ¨ä¸èƒ½ç†è§£çš„è¯ä¹Ÿä¸å¿…å»çº ç»“ã€‚ä½ å¤§å¯ä»¥ä¸ç”¨å…¨å±€å®‰è£…gulpï¼Œä»…åœ¨é¡¹ç›®ä¸­å®‰è£…ã€‚

# å¼€å§‹ä½¿ç”¨

åœ¨é¡¹ç›®ä¸­æ·»åŠ gulpä¾èµ–å¹¶å®‰è£…å®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåå«`gulpfile.js`çš„æ–‡ä»¶ã€‚æˆ‘ä»¬å°†åœ¨è¿™ä¸ªgulpfile.jsæ–‡ä»¶ä¸­å®Œæˆæ‰€æœ‰æ„å»ºä»»åŠ¡çš„è®¾è®¡ã€‚

ä¸€èˆ¬åœ°ï¼Œæˆ‘ä»¬gulpfile.jsæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œ

```javascript
var gulp = require('gulp');

gulp.task('default', function () {
    console.log('default finished.');
});
```

ç„¶åæˆ‘ä»¬ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥`gulp`å°±å¯ä»¥å¼€å§‹æ„ä»¶ä»»åŠ¡ï¼Œ

```bash
[00:54:32] Using gulpfile ~/code/test/test-gulp/gulpfile.js
[00:54:32] Starting 'default'...
default finished.
[00:54:32] Finished 'default' after 98 Î¼s
```

åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨defaultä»»åŠ¡ä¸­å•¥äº‹ä¹Ÿæ²¡å¹²ï¼Œä»…ä»…è¾“å‡ºä¸€æ¡æç¤ºä¿¡æ¯ã€‚

åŸºæœ¬ä¸Šgulpçš„ä½¿ç”¨å°±æ˜¯è¿™æ ·çš„æ¨¡å¼ã€‚


# APIsè¯´æ˜

gulpçš„APIéå¸¸ç®€æ´ï¼Œå¸¸ç”¨çš„APIå°±4ä¸ªï¼Œä»–ä»¬æ˜¯`gulp.task`ï¼Œ`gulp.src`ï¼Œ`gulp.dest`ï¼Œ`gulp.watch`ã€‚

## `gulp.task`

`gulp.task`ç”¨äºå®šä¹‰ä»»åŠ¡ã€‚å…¶å†…éƒ¨ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªåä¸º[Orchestrator](https://github.com/orchestrator/orchestrator)ä»»åŠ¡è°ƒåº¦åº“ã€‚å®ƒçš„ç”¨æ³•å¾ˆç®€å•ï¼Œ

```javascript
gulp.task(name[, deps], fn)
```

| å‚æ•° | ç±»å‹ | æ˜¯å¦å¯é€‰ | è¯´æ˜ |
| :--- | :--- | :---  | :--- |
| `name` | **String** | **å¿…é¡»** | ä»»åŠ¡çš„åç§° |
| `deps` | **Array** | å¯é€‰ | æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºå½“å‰ä»»åŠ¡æ‰€ä¾èµ–çš„å…¶ä»–ä»»åŠ¡ |
| `fn` | **Function** | **å¿…é¡»** | ä»»åŠ¡å…·ä½“è¦æ‰§è¡Œçš„æ“ä½œ |

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œ

```javascript
gulp.task('mytask', ['one', 'two', 'three'], function () {
    doSomething();
});

gulp.task('mytask2', function() {
    doSomething();
});

gulp.task('mytask3', ['one', 'two']);
```

å¦‚ç¤ºä¾‹æ‰€ç¤ºï¼Œå½“æŸä¸€ä¸ªä»»åŠ¡æ²¡æœ‰ä¾èµ–ä»»åŠ¡æ—¶ï¼Œå¯ä»¥çœç•¥`deps`å‚æ•°ã€‚å½“ä¸€ä¸ªä»»åŠ¡æœ‰ä¾èµ–ä»»åŠ¡æ—¶ï¼Œä¹Ÿæ˜¯å¯ä»¥çœç•¥`fn`å‚æ•°çš„ã€‚

### æ§åˆ¶ä¾èµ–é¡ºåº

å½“`gulp.task`å®šä¹‰ä»»åŠ¡å¹¶æœ‰ä¾èµ–ä»»åŠ¡æ—¶ï¼Œgulpé»˜è®¤å°†ä»¥æœ€å¤§çš„å¹¶å‘æ•°å»åŒæ—¶æ‰§è¡Œè¿™äº›ä¾èµ–ä»»åŠ¡ã€‚æ‰€ä»¥gulpé»˜è®¤æ˜¯ä¸ä¿è¯ä¾èµ–ä»»åŠ¡ä¹‹é—´çš„å¼‚æ­¥æ“ä½œç­‰å¾…çš„ã€‚

è‹¥æœ‰ä¸‹é¢è¿™æ ·ä¸€ä¸ªç¤ºä¾‹ï¼Œ

```javascript
gulp.task('one', function() {
    setTimeout(function() {
        console.log('one is done.');
    }, 2000);
});

gulp.task('two', ['one'], function() {
    console.log('two is done.');
});

gulp.task('default', ['one', 'two']);
```

å¦‚æœæˆ‘ä»¬çš„`one`ï¼Œ`two`è¿™ä¸¤ä¸ªä»»åŠ¡å½¼æ­¤ä¹‹é—´æœ‰é¡ºåºä¾èµ–çš„è¯ï¼ˆç¤ºä¾‹ä¸­é‡‡ç”¨setTimeoutæ¥æ¨¡æ‹Ÿå¼‚æ­¥ä»»åŠ¡ï¼‰ï¼Œå³`two`è¦åœ¨`one`çš„å¼‚æ­¥æ“ä½œå®Œæ¯•ä¹‹åæ‰§è¡Œã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥æ‰§è¡Œ`gulp`ï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹ï¼Œ

```bash
[01:25:08] Using gulpfile ~/code/test/test-gulp/gulpfile.js
[01:25:08] Starting 'one'...
[01:25:08] Finished 'one' after 578 Î¼s
[01:25:08] Starting 'two'...
[01:25:08] two is done.
[01:25:08] Finished 'two' after 2.33 ms
[01:25:08] Starting 'default'...
[01:25:08] Finished 'default' after 35 Î¼s
[01:25:10] one is done.
```

å¯ä»¥çœ‹åˆ°ï¼Œä»»åŠ¡`one`å’Œä»»åŠ¡`two`å‡ ä¹æ˜¯åœ¨åŒä¸€æ—¶åˆ»å°±åŒæ—¶æ‰§è¡Œçš„ã€‚ä½†æ˜¯åœ¨*01:25:08*ä»»åŠ¡`two`å°±å·²ç»å®Œæˆäº†ï¼Œè€Œä»»åŠ¡`one`åœ¨*01:25:10*æ‰å®Œæˆã€‚æ‰€ä»¥è¿™å¹¶æ²¡æœ‰è¾¾åˆ°æˆ‘ä»¬çš„è¦æ±‚ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•åšå‘¢ï¼Ÿ

é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸‰ç§æ–¹å¼æ¥è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚

ç¬¬ä¸€ç§æ–¹å¼ï¼šåœ¨å¼‚æ­¥æ“ä½œå®Œæˆåæ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°æ¥é€šçŸ¥gulpè¿™ä¸ªå¼‚æ­¥ä»»åŠ¡å·²ç»å®Œæˆï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å°±æ˜¯ä»»åŠ¡å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥æ”¹å†™ä¸€ä¸‹ä»»åŠ¡`one`ï¼Œ

```javascript
gulp.task('one', function(callback) {
    setTimeout(function() {
        console.log('one is done.');
        callback();
    }, 2000);
});
```

æ­¤æ—¶æˆ‘ä»¬å†æ‰§è¡Œ`gulp`å…¶ç»“æœå¦‚ä¸‹ï¼Œ

```bash
[01:40:02] Using gulpfile ~/code/test/test-gulp/gulpfile.js
[01:40:02] Starting 'one'...
[01:40:04] one is done.
[01:40:04] Finished 'one' after 2.01 s
[01:40:04] Starting 'two'...
[01:40:04] two is done.
[01:40:04] Finished 'two' after 659 Î¼s
[01:40:04] Starting 'default'...
[01:40:04] Finished 'default' after 12 Î¼s
```

å¦‚æ­¤æˆ‘ä»¬å°±èƒ½ä¿è¯åœ¨æ‰§è¡Œ`two`ä¹‹å‰ï¼Œ`one`çš„å¼‚æ­¥æ“ä½œä¹Ÿæ‰§è¡Œå®Œæ¯•äº†ã€‚

ä¸‹é¢æˆ‘ä»¬ä»‹ç»å¦å¤–ä¸¤ç§æ–¹å¼ã€‚

ç¬¬äºŒç§æ–¹å¼ï¼šå®šä¹‰ä»»åŠ¡æ—¶è¿”å›ä¸€ä¸ªæµå¯¹è±¡ã€‚

æ¯”å¦‚ï¼Œ

```javascript
gulp.task('one', function() {
    return gulp.src('client/**/*.js')
        .pipe(minify())
        .pipe(gulp.dest('build'));
});

gulp.task('two', ['one'], function() {
    console.log('two is done.');
});

gulp.task('default', ['one', 'two']);
```

ç¬¬ä¸‰ç§æ–¹å¼ï¼šè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ã€‚

æ¯”å¦‚ï¼Œ

```javascript
var Q = require('q');

gulp.task('one',function(cb){
    var deferred = Q.defer();
  
    setTimeout(function() {
        deferred.resolve();
    }, 5000);
  
    return deferred.promise;
});

gulp.task('two', ['one'], function(){
    console.log('two is done.');
});

gulp.task('default', ['one', 'two']);
```

**æ€»ç»“**ï¼Œ

- callbackå’Œè¿”å›promiseçš„æ–¹å¼æ›´å…·æ™®é€‚æ€§ï¼Œè€Œè¿”å›streamçš„æ–¹å¼æ›´åŠ åˆé€‚`gulp.src`ç›¸å…³çš„æ“ä½œã€‚
- callbackæ–¹å¼åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½æ›´åŠ çµæ´»ã€‚æ¯”å¦‚ä»»åŠ¡ä¸­æºæ‚äº†ä¸€äº›ä¸šåŠ¡é€»è¾‘çš„æ—¶å€™ã€‚



## `gulp.src`

å‰é¢è¯´è¿‡gulpçš„å·¥ä½œæœºåˆ¶æ˜¯åŸºäºNode.jsä¸­çš„æµã€‚è¿™é‡Œæ‰€è¯´çš„æµå¹¶ä¸æ˜¯Node.jsåŸå§‹çš„æµå¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ç§è™šæ‹Ÿæ–‡ä»¶æµå¯¹è±¡ï¼ˆ[Vinyl files](https://github.com/gulpjs/vinyl-fs)ï¼‰ï¼Œè¿™ä¸ªè™šæ‹Ÿæ–‡ä»¶å¯¹è±¡ä¸­å­˜å‚¨ç€åŸå§‹æ–‡ä»¶çš„è·¯å¾„ã€æ–‡ä»¶åã€å†…å®¹ç­‰ä¿¡æ¯ã€‚æˆ‘ä»¬ä¸å…³æ³¨è¿™ä¸ªï¼Œåé¢å†è®²è§£å†™gulpæ’ä»¶æ—¶ä¼šå†æ¬¡é˜è¿°è¿™å—å†…å®¹ã€‚

æ‰€ä»¥ï¼Œç®€å•æ¥è¯´`gulp.src`å°±æ˜¯ç”¨æ¥è·å–ä½ éœ€è¦æ“ä½œçš„æ–‡ä»¶çš„ã€‚å®ƒçš„ç”¨æ³•å¦‚ä¸‹ï¼Œ

```javascript
gulp.src(globs[, options])
```

| å‚æ•° | ç±»å‹ | æ˜¯å¦å¯é€‰ | è¯´æ˜ |
| :--- | :--- | :---  | :--- |
| `globs` | **String**, **Array** | **å¿…é€‰** | æ–‡ä»¶åŒ¹é…æ¨¡å¼ |
| `options` | **Object** | å¯é€‰ | åŒ¹é…é€‰é¡¹ |

`gulp.src`å†…éƒ¨ä½¿ç”¨[node-glob](https://github.com/isaacs/node-glob)æ¨¡å—æ¥å®ç°æ–‡ä»¶åŒ¹é…ã€‚node-globæ˜¯ä¸€ç§ä¸æ­£åˆ™è¡¨è¾¾å¼ç±»ä¼¼çš„åŒ¹é…èŒƒå¼ã€‚

`globs`å‚æ•°ä¹Ÿå¯ä»¥ç›´æ¥æ˜¯ç”¨ä¸€ä¸ªæ–‡ä»¶åœ°å€ï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªåŒ¹é…æ¨¡å¼çš„æ•°ç»„ã€‚è€Œ`options`å‚æ•°æ˜¯ç”¨æ¥è¾…åŠ©åŒ¹é…çš„ï¼Œå®ƒçš„æŸäº›å‚æ•°è®¾ç½®å°†ä¼šå½±å“è™šæ‹Ÿæ–‡ä»¶æµçš„è·å–ã€‚

### æ¨¡å¼åŒ¹é…

node-globä¸­æœ‰å¦‚ä¸‹å‡ ç§åŒ¹é…è§„åˆ™ï¼Œ

| åŒ¹é…èŒƒå¼ | ç”¨æ³• |
| :--- | :--- |
| `*` | åŒ¹é…0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œä½†ä¸ä¼šåŒ¹é…è·¯å¾„åˆ†éš”ç¬¦ï¼Œé™¤éè·¯å¾„åˆ†éš”ç¬¦å‡ºç°åœ¨æœ«å°¾ |
| `**` | åŒ¹é…0ä¸ªæˆ–å¤šä¸ªç›®å½•åŠå…¶å­ç›®å½•ï¼Œéœ€è¦å•ç‹¬å‡ºç°ã€‚å¦‚æœå‡ºç°åœ¨æœ«å°¾ï¼Œä¹Ÿèƒ½åŒ¹é…æ–‡ä»¶ |
| `?` | åŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œä¸ä¼šåŒ¹é…è·¯å¾„åˆ†éš”ç¬¦ |
| `[...]` | åŒ¹é…æ–¹æ‹¬å·ä¸­å‡ºç°çš„å­—ç¬¦ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œå½“æ–¹æ‹¬å·ä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º^æˆ–!æ—¶ï¼Œè¡¨ç¤ºå–å |
| `!(p1,p2,p3)` | åŒ¹é…ä»»ä½•ä¸æ‹¬å·ä¸­ç»™å®šçš„ä»»ä¸€æ¨¡å¼éƒ½ä¸åŒ¹é…çš„ |
| `?(p1,p2,p3)` | åŒ¹é…æ‹¬å·ä¸­ç»™å®šçš„ä»»ä¸€æ¨¡å¼0æ¬¡æˆ–1æ¬¡ |
| `+(p1,p2,p3)` | åŒ¹é…æ‹¬å·ä¸­ç»™å®šçš„ä»»ä¸€æ¨¡å¼è‡³å°‘1æ¬¡ |
| `*(p1,p2,p3)` | åŒ¹é…æ‹¬å·ä¸­ç»™å®šçš„ä»»ä¸€æ¨¡å¼0æ¬¡æˆ–å¤šæ¬¡ |
| `@(p1,p2,p3)` | åŒ¹é…æ‹¬å·ä¸­ç»™å®šçš„ä»»ä¸€æ¨¡å¼1æ¬¡ |
| `{p1,p2}` | ä»¥å±•å¼€æ¨¡å¼è¿›è¡ŒåŒ¹é… |

> **å¤‡æ³¨**ï¼š `(p1,p2,p3)`ä¸­çš„`,`å…¶å®æ˜¯`|`ã€‚å¦‚æœå†™æˆ`p1|p2|p3`ï¼Œå°†ä¼šå¯¼è‡´markdownè§£æé”™è¯¯ã€‚æš‚æ—¶æ²¡æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œæœ›çŸ¥é“çš„å¤§ç¥å‘ŠçŸ¥ğŸ˜‚

å…³äºnode-globæ›´å¤šçš„ç”¨æ³•ï¼Œè¯·å‚é˜…[node-glob](https://github.com/isaacs/node-glob)çš„ç›¸å…³æ–‡æ¡£ã€‚ä¸è¿‡åŸºæœ¬ä¸Šä¸Šé¢çš„å‡ ç§ç”¨æ³•å°†ä¼šè¦†ç›–`gulp.src`90%ä»¥ä¸Šçš„åœºæ™¯ã€‚

ä¸‹é¢æ˜¯ä¸€äº›æ›´è¯¦ç»†çš„ç¤ºä¾‹ï¼Œ

- `*`èƒ½åŒ¹é…`a.js`ï¼Œ`x.y`ï¼Œ`abc`ï¼Œ`abc/`ï¼Œä½†ä¸èƒ½åŒ¹é…`a/b.js`
- `*.*`èƒ½åŒ¹é…`a.js`ï¼Œ`style.css`ï¼Œ`a.b`ï¼Œ`x.y`
- `*/*/*.js`èƒ½åŒ¹é…`a/b/c.js`ï¼Œ`x/y/z.js`ï¼Œä¸èƒ½åŒ¹é…`a/b.js`ï¼Œ`a/b/c/d.js`
- `**`èƒ½åŒ¹é…`abc`ï¼Œ`a/b.js`ï¼Œ`a/b/c.js`ï¼Œ`x/y/z`ï¼Œ`x/y/z/a.b`ï¼Œèƒ½ç”¨æ¥åŒ¹é…æ‰€æœ‰çš„ç›®å½•å’Œæ–‡ä»¶
- `**/*.js`èƒ½åŒ¹é…`foo.js`ï¼Œ`a/foo.js`ï¼Œ`a/b/foo.js`ï¼Œ`a/b/c/foo.js`
- `a/**/z`èƒ½åŒ¹é…`a/z`ï¼Œ`a/b/z`ï¼Œ`a/b/c/z`ï¼Œ`a/d/g/h/j/k/z`
- `a/**b/z`èƒ½åŒ¹é…`a/b/z`ï¼Œ`a/sb/z`ï¼Œä½†ä¸èƒ½åŒ¹é…`a/x/sb/z`ï¼Œå› ä¸ºåªæœ‰å•`**`å•ç‹¬å‡ºç°æ‰èƒ½åŒ¹é…å¤šçº§ç›®å½•
- `?.js`èƒ½åŒ¹é…`a.js`ï¼Œ`b.js`ï¼Œ`c.js`
- `a??`èƒ½åŒ¹é…`a.b`ï¼Œ`abc`ï¼Œä½†ä¸èƒ½åŒ¹é…`ab/`ï¼Œå› ä¸ºå®ƒä¸ä¼šåŒ¹é…è·¯å¾„åˆ†éš”ç¬¦
- `[xyz].js`åªèƒ½åŒ¹é…`x.js`ï¼Œ`y.js`ï¼Œ`z.js`ï¼Œä¸ä¼šåŒ¹é…`xy.js`ï¼Œ`xyz.js`ç­‰ï¼Œæ•´ä¸ªä¸­æ‹¬å·åªä»£è¡¨ä¸€ä¸ªå­—ç¬¦
- `[^xyz].js`èƒ½åŒ¹é…`a.js`ï¼Œ`b.js`ï¼Œ`c.js`ç­‰ï¼Œä¸èƒ½åŒ¹é…`x.js`ï¼Œ`y.js`ï¼Œ`z.js`
- `a{b,c}d.js`èƒ½åŒ¹é…`abd.js`ï¼Œ`acd.js`ï¼Œä¸èƒ½åŒ¹é…`abcd.js`

æˆ‘ä»¬è¿˜å¯ä»¥å°†å¤šä¸ªåŒ¹é…æ¨¡å¼ç»„åˆæˆä¸€ä¸ªæ•°ç»„ä¼ é€’ç»™`gulp.src`ï¼Œæ¯”å¦‚

```javascript
gulp.src(['js/*.js', 'css/*.js', 'views/*.html']);
```

åœ¨ä½¿ç”¨è¿™ä¸€æ–¹å¼æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªåæ¨¡å¼ç”¨æ¥åœ¨ä¹‹å‰çš„åŒ¹é…ç»“æœä¸­æ’é™¤æŸäº›åŒ¹é…é¡¹ï¼Œæ¯”å¦‚

```javascript
gulp.src(['js/*.js', '!js/jquery.js']);
```

å› ä¸ºåæ¨¡å¼æ˜¯åœ¨ä¹‹å‰çš„åŒ¹é…ç»“æœåšæ’é™¤çš„ï¼Œæ‰€ä»¥åæ¨¡å¼ä¸èƒ½æ”¾åœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§æ–¹å¼æ˜¯ä¸æ­£ç¡®ç”¨æ³•ï¼Œ

```javascript
gulp.src(['!js/jquery.js', 'js/*.js']); // åæ¨¡å¼ä½äºåŒ¹é…æ¨¡å¼æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œæ­¤æ—¶å°†èµ·ä¸åˆ°æ’é™¤ä½œç”¨
```

### åŒ¹é…å‚æ•°

æˆ‘ä»¬å¯ä»¥é€šè¿‡`options`ç»™`gulp.src`ä¼ é€’åŒ¹é…å‚æ•°ã€‚`options`é™¤äº†node-globåŸæœ‰çš„ä¸€äº›å‚æ•°ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›é¢å¤–çš„å‚æ•°ã€‚

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- |
| `options.buffer` | `true` | gulpçš„è™šæ‹Ÿæ–‡ä»¶å¯¹è±¡é»˜è®¤ä»¥bufferçš„å½¢å¼è¿”å›æ–‡ä»¶å†…å®¹ã€‚è‹¥æ­¤é¡¹ä¸º`false`ï¼Œåˆ™ä»¥streamçš„å½¢å¼è¿”å›æ–‡ä»¶å†…å®¹ |
| `options.read` | `true` | gulpé»˜è®¤æ˜¯ä¼šè¿›è¡Œè¯»å–æ–‡ä»¶å†…å®¹æ“ä½œçš„ã€‚è‹¥æ­¤é¡¹è¢«è®¾ç½®ä¸º`false`åˆ™gulpåˆ™ä¸ä¼šå»è¯»å–æ–‡ä»¶ |
| `options.base` | æ¨¡å¼åŒ¹é…ä¸­ç›´åˆ°å‡ºç°é€šé…ç¬¦ä¹‹å‰çš„å­—ç¬¦ä¸² | è¿™ä¸ªå‚æ•°è·Ÿ`gulp.dest`çš„æœ€ç»ˆè·¯å¾„æ¯æ¯ç›¸å…³ |

è¿™äº›å‚æ•°ä¸­ï¼Œå”¯ä¸€å€¼å¾—ä¸€æå°±æ˜¯`options.base`ã€‚å…·ä½“è¯·æ¥ç€å¾€ä¸‹çœ‹ã€‚

## `gulp.dest`

`gulp.dest`ç®€å•æ¥è¯´å°±æ˜¯ç”¨æ¥å†™æ–‡ä»¶çš„ã€‚å…¶ç”¨æ³•å¦‚ä¸‹ï¼Œ

```javascript
gulp.dest(path[, options])
```

| å‚æ•° | ç±»å‹ | æ˜¯å¦å¯é€‰ | è¯´æ˜ |
| :--- | :--- | :---  | :--- |
| `path` | **String** | **å¿…é€‰** | å†™å…¥æ–‡ä»¶çš„è·¯å¾„ |
| `options` | **Object** | å¯é€‰ | å†™å…¥æ–‡ä»¶æ—¶çš„å‚æ•° |

è¿™é‡Œå”¯ä¸€å€¼å¾—ä¸€æå°±æ˜¯å†™å…¥æ–‡ä»¶çš„è·¯å¾„ã€‚è¿™é‡Œçš„å†™å…¥è·¯å¾„æ˜¯gulpç»“åˆ`gulp.src`ä¸­çš„`options.base`å‚æ•°æ¥è®¡ç®—çš„ï¼Œæˆ‘ä»¬ä¼ å…¥çš„`path`å‚æ•°å…¶å®åªæ˜¯æœ€ç»ˆç”Ÿæˆæ–‡ä»¶è·¯å¾„çš„æ–‡ä»¶å¤¹ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œ

```javascript
gulp.src('js/jquery.js')
    .pipe(gulp.dest('dist/build.js'));
```

ä¸Šé¢çš„ä»£ç æœ€ç»ˆå†™çš„æ–‡ä»¶è·¯å¾„æ˜¯**`dist/build.js/jquery.js`**ï¼Œè€Œä¸æ˜¯`dist/build.js`ã€‚

å…¶å®ï¼Œ`gulp.dest`åœ¨å†™æ–‡ä»¶æ—¶ï¼Œå…¶æ­¥éª¤å¯ä»¥ç®€å•æŠ½è±¡å¦‚ä¸‹ï¼Œ

1. å°†`gulp.src`å¾—åˆ°çš„æ–‡ä»¶è·¯å¾„åˆ†è§£ä¸º**base** + **matched**çš„å½¢å¼ã€‚è€Œbaseæ˜¯åŒ¹é…æ¨¡å¼ä¸­**å¼€å§‹å‡ºç°é€šé…ç¬¦ä¹‹å‰**çš„è·¯å¾„ï¼Œmatchedæ˜¯**å¼€å§‹å‡ºç°é€šé…ç¬¦ä¹‹å**çš„è·¯å¾„ã€‚å¦‚æœåŒ¹é…æ¨¡å¼ä¸­æ²¡æœ‰é€šé…ç¬¦ï¼Œåˆ™matchedä¸ºæ–‡ä»¶åã€‚æ‰€ä»¥ç¤ºä¾‹ä¸­çš„baseä¸º`js/`ï¼Œmatchedä¸º`jquery.js`ã€‚
2. `gulp.dest`çš„è§„åˆ™æ˜¯ä½¿ç”¨å†™å…¥è·¯å¾„å‚æ•°æ›¿æ¢baseï¼Œå†åŠ ä¸Šmatchedã€‚å³`dest-path` + `matched`ã€‚æ‰€ä»¥ç¤ºä¾‹ä¸­æœ€ç»ˆçš„è·¯å¾„ä¸º`dist/build.js/jquery.js`ã€‚
3. å¦‚æœ`gulp.dest`æœ€ç»ˆå¾—åˆ°å†™å…¥è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„è·¯å¾„ã€‚

å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œ

```javascript
// å‡è®¾è¦åŒ¹é…çš„æ–‡ä»¶è·¯å¾„ä¸ºsrc/public/js/jquery.js
gulp.src('src/public/**/*.js')      // base: src/public/    matched: js/jquery.js
    .pipe(gulp.dest('dist/build')); // result: dist/build/js/jquery.js

gulp.src('src/public/**/*.js', {base: 'src'}) // base: src/    matched: public/js/jquery.js
    .pipe(gulp.dest('dist'))               // dist/public/js/jquery.js
```

**æ³¨æ„**ï¼Œ

- å½“æ‰‹åŠ¨é…ç½®`options.base`æ—¶ï¼Œå°†å¯¼è‡´matchedä¹Ÿä¼šè·Ÿç€å‘ç”Ÿå˜åŒ–ã€‚
- æ‰‹åŠ¨è®¾ç½®çš„`options.base`å¿…é¡»æ˜¯åŸå§‹baseå­—ç¬¦ä¸²çš„æŸä¸ªå¼€å§‹å­—ä¸²ã€‚æ¯”å¦‚ç¤ºä¾‹ä¸­åŸå§‹baseä¸²æ˜¯`src/public`ï¼Œé‚£ä¹ˆæ‰‹åŠ¨è®¾ç½®çš„baseåªèƒ½æ˜¯`src`æˆ–è€…`src/public`ï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–çš„ï¼Œå¦åˆ™å°†ä¸èƒ½æ­£ç¡®å†™å…¥æ–‡ä»¶ã€‚

### å†™å…¥å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- |
| `options.cwd` | `process.cwd()` | è¾“å‡ºç›®å½•çš„cwdå‚æ•°ï¼Œåªåœ¨æ‰€ç»™çš„è¾“å‡ºç›®å½•æ˜¯ç›¸å¯¹è·¯å¾„æ—¶å€™æœ‰æ•ˆã€‚ |
| `options.mode` | **0777** | å…«è¿›åˆ¶æƒé™å­—ç¬¦ï¼Œç”¨ä»¥å®šä¹‰æ‰€æœ‰åœ¨è¾“å‡ºç›®å½•ä¸­æ‰€åˆ›å»ºçš„ç›®å½•çš„æƒé™ã€‚ |

å†™å…¥å‚æ•°ä¸€èˆ¬éƒ½ä¸ç”¨è‡ªå®šä¹‰ã€‚

## `gulp.watch`

`gulp.watch`ç”¨æ¥ç›‘è§†æ–‡ä»¶çš„å˜åŒ–ï¼Œå½“æ–‡ä»¶å‘ç”Ÿå˜åŒ–åï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥æ‰§è¡Œç›¸åº”çš„ä»»åŠ¡ã€‚å…¶å†…éƒ¨æ˜¯åŸºäº[gaze](https://github.com/shama/gaze)å®ç°çš„ã€‚

å…¶ç”¨æ³•å¦‚ä¸‹ï¼Œ

```javascript
gulp.watch(glob[, opts], tasks)
```

æˆ–è€…

```javascript
gulp.watch(glob[, opts], fn)
```

| å‚æ•° | ç±»å‹ | æ˜¯å¦å¯é€‰ | è¯´æ˜ |
| :--- | :--- | :---  | :--- |
| `glob` | **String**, **Array** | **å¿…é¡»** | åŒ`gulp.src` |
| `opts` | **Object** | å¯é€‰ | - |
| `tasks` | **Array** | **å¿…é¡»** | ä¸ºæ–‡ä»¶å˜åŒ–åè¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¸ºä¸€ä¸ªæ•°ç»„ |
| `fn` | **Function** | **å¿…é¡»** | æ–‡ä»¶å˜åŒ–åéœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œå‡½æ•°å‚æ•°ä¸ºä¸€ä¸ªå¯¹è±¡ |


æ¥çœ‹ä¸ªä¾‹å­ï¼Œ

```javascript
gulp.task('uglify',function(){
  //do something
});
gulp.task('reload',function(){
  //do something
});
gulp.watch('js/**/*.js', ['uglify','reload']);
```

ä½¿ç”¨`fn`çš„ä¾‹å­ï¼Œ

```javascript
gulp.watch('js/**/*.js', function(ev){
    console.log(ev.type); //å˜åŒ–ç±»å‹ addedä¸ºæ–°å¢,deletedä¸ºåˆ é™¤ï¼Œchangedä¸ºæ”¹å˜ 
    console.log(ev.path); //å˜åŒ–çš„æ–‡ä»¶çš„è·¯å¾„
}); 
```

# å‚è€ƒåˆ—è¡¨

- [gulp](http://gulpjs.com/)
- [gulpä¸­æ–‡ç½‘](http://www.gulpjs.com.cn/)
- [å‰ç«¯æ„å»ºå·¥å…·gulpjsçš„ä½¿ç”¨ä»‹ç»åŠæŠ€å·§](http://www.cnblogs.com/2050/p/4198792.html)



