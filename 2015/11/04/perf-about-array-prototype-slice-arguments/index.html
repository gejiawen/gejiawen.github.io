

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    
    <meta name="author" content="gejiawen">
    
    <meta name="description" content="å‰è¨€åœ¨æˆ‘åšå®¢ä¹‹å‰æœ‰è¿‡è¿™æ ·ä¸€ç¯‡æ–‡ç« ï¼ŒJSä¸­æ˜“æ··æ·†æ–¹æ³•å¤‡å¿˜å½•ã€‚å…¶ä¸­æœ‰ä»‹ç»å¯ä»¥åˆ©ç”¨ä¸€ç§çº¦å®šæŠ€å·§å°†ç±»æ•°ç»„å¯¹è±¡è½¬æ¢æˆå¯¹è±¡ã€‚å¦‚ä¸‹
123456function foo() &amp;#123;    console.log(arguments);    var args = Array.prototype.slice.">
    
    

    
    <link rel="alternative" href="atom.xml" title="è›‹ç³•ä»™äºº" type="application/atom+xml">
    
    
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Array.prototype.slice(arguments)çš„çŒ«è…» | è›‹ç³•ä»™äºº Â· æŠ€æœ¯äººéœ€è¦å±æœºæ„Ÿ</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/style.css">

    <!-- Javascript -->
    <script src="/js/jquery-2.1.0.min.js"></script>
    <script src="/js/jquery.backstretch.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script src="/js/headroom.min.js"></script>
    <script src="/js/jquery.headroom.min.js"></script>
    <script src="/js/common.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    
    <meta name="baidu-site-verification" content="SzJ3MGdmeo" />


    <meta name="360-site-verification" content="afe5dc96bbb8d111b618f78493b95bb8" />


    <!--<meta name="baidu-site-verification" content="SzJ3MGdmeo" />-->
    <!--<meta name="360-site-verification" content="afe5dc96bbb8d111b618f78493b95bb8" />-->

</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-inverse" role="banner">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://blog.gejiawen.com" title="è›‹ç³•ä»™äºº">è›‹ç³•ä»™äºº</a>
            </div>

            <div role="navigation" class="collapse navbar-collapse bs-navbar-collapse">
                
                <ul class="nav navbar-nav pull-right">
                    <li>
                        <a class="max-width max-w300" title="æŠ€æœ¯äººéœ€è¦å±æœºæ„Ÿ" href="/feelings">æŠ€æœ¯äººéœ€è¦å±æœºæ„Ÿ</a>
                    </li>
                </ul>
                

                <ul class="nav navbar-nav">
                    
                    <li id="nav-index">
                        <a href="/" target="">é¦–é¡µ</a>
                    </li>
                    
                    <li id="nav-archives">
                        <a href="/archives" target="">å½’æ¡£</a>
                    </li>
                    
                    <li id="nav-categories">
                        <a href="/categories" target="">åˆ†ç±»</a>
                    </li>
                    
                    <li id="nav-tags">
                        <a href="/tags" target="">æ ‡ç­¾</a>
                    </li>
                    
                    <li id="nav-pick">
                        <a href="http://book.gejiawen.com/fucking-days-to-be-a-coder" target="_blank">æ‹¾é—</a>
                    </li>
                    
                    <li id="nav-about">
                        <a href="/about" target="">å…³äº</a>
                    </li>
                    

                    <li id="nav-github"><a href="https://github.com/gejiawen" target="_blank">GitHub</a></li>
                    <!--<li id="nav-rss"><a href="/atom.xml" target="_blank">Rss</a></li>-->
                    <li id="nav-search"><input type="text" id="search" placeholder="search" /></li>
                </ul>
            </div>
        </div>
    </nav>

    <script>
    var bgRoot = "http://7xkwt1.com1.z0.glb.clouddn.com/background-";
    var bgLength = "74";
    var bgRandom = false;
    var bgImage = "http://7xkwt1.com1.z0.glb.clouddn.com/background-64.jpg";

    $(function() {
        // page-id...
        var pageId = "2015/11/04/perf-about-array-prototype-slice-arguments/";
        pageId = pageId.substr(0, pageId.indexOf("/"));
        if(pageId === "") pageId = "index";

        $("#nav-" + pageId).addClass("active");
    });
    </script>

    <article class="post container">
    <div class="well post-body first-post last-post">
        <h1>Array.prototype.slice(arguments)çš„çŒ«è…»</h1>

        <div class="time-info">
            
<span class="article-tags">
    
    Tags: <a href="/tags/js/">js</a>&nbsp;
</span>



<span class="article-categories">
    Category:
    <a class="article-category-link" href="/categories/è¸©å‘å½•/">è¸©å‘å½•</a>
</span>


        </div>
        <div class="time-info">
            å‘è¡¨: <time datetime="2015-11-04T03:25:43.000Z"
                       itemprop="datePublished">2015-11-04 11:25:43</time>
            
            æ›´æ–°: <time datetime="2017-01-15T17:16:24.000Z"
                       itemprop="dateModified">2017-01-16 01:16:24</time>
            
        </div>

        <div class="post-body-inner">
            
                <div id="toc" class="toc-article well">
                    <strong class="toc-title">å¤§çº²</strong>
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#åŸç†"><span class="toc-number">2.</span> <span class="toc-text">åŸç†</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#çŒ«è…»"><span class="toc-number">3.</span> <span class="toc-text">çŒ«è…»</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å‚è€ƒ"><span class="toc-number">4.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol>
                </div>
            

            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨æˆ‘åšå®¢ä¹‹å‰æœ‰è¿‡è¿™æ ·ä¸€ç¯‡æ–‡ç« ï¼Œ<a href="http://blog.gejiawen.com/2015/04/02/confused-methods-in-javascript">JSä¸­æ˜“æ··æ·†æ–¹æ³•å¤‡å¿˜å½•</a>ã€‚å…¶ä¸­æœ‰ä»‹ç»å¯ä»¥åˆ©ç”¨ä¸€ç§çº¦å®šæŠ€å·§å°†ç±»æ•°ç»„å¯¹è±¡è½¬æ¢æˆå¯¹è±¡ã€‚å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(args);</span><br><span class="line">    <span class="comment">// more logic</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨javascriptä¸­ï¼Œå‡½æ•°ä¸­çš„<code>arguments</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å†…ç½®å˜é‡ï¼Œå®ƒå…¶å®æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å…¶å†…éƒ¨çš„è¡¨ç°å´è·Ÿæ•°ç»„ä¸€è‡´ã€‚å¦‚ä¸‹å›¾ï¼Œ</p>
<p><img src="/res/perf-about-array-prototype-slice-arguments/001.png" alt=""></p>
<p>å…¶ä¸­<code>arguments.callee</code>å’Œ<code>arguments.Symbol</code>å±æ€§éƒ½æ˜¯ä¸å¯æšä¸¾çš„ï¼ˆæ— æ³•ç”¨<code>for...in</code>éå†ï¼‰ã€‚</p>
<p>åœ¨ç»è¿‡<code>var args = Array.prototype.slice.call(arguments)</code>æ“ä½œä¹‹åï¼Œä»ä¸Šå›¾å¯è§ï¼Œ<code>args</code>çš„ç»“æœæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚</p>
<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>å¦‚æœä½ ä¸æ¸…æ¥šä¸Šé¢å†…å®¹çš„å†…å¹•ï¼Œä½ å¯èƒ½ç¦ä¸ä½è¦é—®ä¸ªä¸ºä»€ä¹ˆï¼ä¸‹é¢æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹å…¶ä¸­çš„å†…å¹•ã€‚</p>
<p>é¦–å…ˆï¼Œåœ¨Javascriptä¸­æœ‰ä¸¤ä¸ª<code>slice</code>æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯<code>Array.prototype.slice</code>å’Œ<code>String.prototype.slice</code>ã€‚å¦‚æœä½ å¯¹<code>xxx.prototype.xxx</code>è¿™ç§å†™æ³•æœ‰ç–‘é—®ï¼Œæˆ‘æƒ³ä½ å¯èƒ½éœ€è¦è¡¥å……ä¸€ä¸‹Javascriptä¸­åŸå‹ç›¸å…³çš„çŸ¥è¯†äº†ï¼ˆæ— èŠ‚æ“å°å¹¿å‘Šï¼š<a href="http://blog.gejiawen.com/2014/09/29/ecmascript-inherit/">æ¨èæ–‡ç« 1</a>ï¼Œ<a href="http://blog.gejiawen.com/2014/10/16/prototype-inherit-in-javascript/">æ¨èæ–‡ç« 2</a>ï¼Œ<a href="http://blog.gejiawen.com/2015/03/18/different-from-proto-and-prototype/">æ¨èæ–‡ç« 3</a>ï¼‰ã€‚è¿™é‡Œæˆ‘ä»¬è¦è¯´çš„å°±æ˜¯å‰è€…ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹å‡ ä¸ªä¾‹å­ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> t1 = &#123; <span class="number">0</span>: <span class="string">'a'</span>, <span class="number">1</span>: <span class="string">'b'</span>, <span class="number">2</span>: <span class="string">'c'</span>, length: <span class="number">3</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> t2 = &#123; <span class="number">0</span>: <span class="string">'a'</span>, <span class="number">1</span>: <span class="string">'b'</span>, <span class="number">2</span>: <span class="string">'c'</span>, length: <span class="number">3</span>, <span class="string">'name'</span>: <span class="string">'larry ge'</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> t3 = &#123; <span class="number">0</span>: <span class="string">'a'</span>, <span class="number">1</span>: <span class="string">'b'</span>, length: <span class="number">3</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> t4 = &#123; length: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> t5 = &#123; <span class="number">0</span>: <span class="string">'a'</span>, <span class="number">1</span>: <span class="string">'b'</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> slice = [].slice;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(slice.call(t1)); <span class="comment">// ['a', 'b', 'c']</span></span><br><span class="line"><span class="built_in">console</span>.log(slice.call(t2)); <span class="comment">// ['a', 'b', 'c']</span></span><br><span class="line"><span class="built_in">console</span>.log(slice.call(t3)); <span class="comment">// ['a', 'b']</span></span><br><span class="line"><span class="built_in">console</span>.log(slice.call(t4)); <span class="comment">// []</span></span><br><span class="line"><span class="built_in">console</span>.log(slice.call(t5)); <span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<p>å¯è§ï¼Œæˆ‘ä»¬åªèƒ½è½¬åŒ–å¯¹è±¡ä¸­<strong>ä»¥æ•°å­—ä¸ºé”®å€¼</strong>çš„å±æ€§ï¼ŒåŒæ—¶å¿…é¡»è¦æ±‚å¯¹è±¡ä¸­æœ‰å€¼ä¸ºæ•°å­—çš„<code>length</code>å±æ€§ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çŒœæƒ³ä¸€ä¸‹<code>slice</code>å†…éƒ¨å¤§æ¦‚æ˜¯å¦‚ä½•å®ç°çš„äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.slice = <span class="function"><span class="keyword">function</span>(<span class="params">start, end</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    start = start || <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„thisæŒ‡ä»£å½“å‰è°ƒç”¨æ­¤sliceæ–¹æ³•çš„æ•°ç»„ï¼Œ</span></span><br><span class="line">    <span class="comment">// å¦‚æœä½¿ç”¨callæˆ–è€…applyï¼Œè¿™ä¸ªthiså°†ä¼šè¢«é‡å®šå‘ã€‚</span></span><br><span class="line">    <span class="comment">// è¿™ä¹Ÿå°±æ˜¯ä¸ºä½•åœ¨æ²¡æœ‰endå‚æ•°çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»è¦æœ‰lengthå±æ€§çš„åŸå› ã€‚</span></span><br><span class="line">    end = end || <span class="keyword">this</span>.length; </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = start; i &lt; end; i++)&#123;</span><br><span class="line">        <span class="comment">// result.push(this[i]);</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œä½¿ç”¨çš„æ˜¯this[i]ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥å‰é¢ç¤ºä¾‹ä¸­çš„å¯¹è±¡ä¸­é‚£äº›ä¸æ˜¯ä»¥æ•°å­—ä¸ºé”®çš„å±æ€§éƒ½æ˜¯æ‹¿ä¸åˆ°çš„ã€‚</span></span><br><span class="line">        result[i] = <span class="keyword">this</span>[i]; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨<code>Array.prototype.slice.call</code>æˆ–è€…<code>Array.prototype.slice.apply</code>æ—¶ï¼Œå°†ä¼šæŠŠå‡½æ•°ä¸­çš„<code>this</code>è‡ªåŠ¨æ›¿æ¢æˆæˆ‘ä»¬ä¼ å…¥çš„å¯¹è±¡ã€‚å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸€ä¸ªæ•°ç»„äº†ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯è¿™ç§æŠ€å·§çš„åŸç†äº†ã€‚</p>
<p>è¡ç”Ÿçš„ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæœ‰å¦‚ä¸‹ä¸‰ç§æ–¹æ³•å°†ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡è½¬æ¢æˆçœŸæ­£çš„æ•°ç»„ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•ä¸€</span></span><br><span class="line"><span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•äºŒ</span></span><br><span class="line"><span class="keyword">var</span> args = [].slice.call(<span class="built_in">arguments</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸‰</span></span><br><span class="line"><span class="keyword">var</span> args = []; </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123; </span><br><span class="line">    <span class="comment">// args.push(arguments[i]);</span></span><br><span class="line">    args[i] = <span class="built_in">arguments</span>[i]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="çŒ«è…»"><a href="#çŒ«è…»" class="headerlink" title="çŒ«è…»"></a>çŒ«è…»</h1><p>å½“ä½¿ç”¨<code>[].slice.call</code>å°†ç±»æ•°ç»„è½¬æ¢æ•°ç»„æˆä¸ºä¸€ç§æ™®éæŠ€å·§æ—¶ï¼ˆæˆ‘ä¹Ÿæ˜¯ä¸€ç›´è¿™ä¹ˆç”¨çš„ï¼‰ï¼Œæˆ‘è§‰å¾—è¿™æ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œåº”è¯¥ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚ç›´åˆ°æˆ‘å‰æ®µæ—¶é—´è¯»<a href="https://github.com/tj/node-thunkify" target="_blank" rel="external">tj/node-thunkify</a>æºç æ—¶ï¼Œçªç„¶å‘ç°ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ã€‚</p>
<p>node-thunkifyæ˜¯ä¸€ä¸ªç”¨æ¥å°†ä¸€ä¸ªæ™®é€šå‡½æ•°è½¬åŒ–æˆthunkå‡½æ•°çš„ï¼Œå®ƒçš„<a href="https://github.com/tj/node-thunkify/blob/master/index.js" target="_blank" rel="external">æºç </a>å…¶å®å¾ˆç®€å•ï¼Œå…¶ä¸­æœ‰ä¸€æ®µï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// more code</span></span><br><span class="line"><span class="keyword">var</span> args = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="built_in">arguments</span>.length);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; args.length; ++i) &#123;</span><br><span class="line">    args[i] = <span class="built_in">arguments</span>[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// more code</span></span><br></pre></td></tr></table></figure>
<p>å½“æ—¶æˆ‘å°±å¥‡æ€ªäº†ï¼Œè¿™é‡Œæ€ä¹ˆä½¿ç”¨forå¾ªç¯éå†argumentså¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸€è´¯çš„è½¬æ¢æŠ€å·§å‘¢ï¼Ÿéš¾é“æœ‰ä»€ä¹ˆçŒ«è…»ï¼Ÿ</p>
<p>æœç„¶ä¸å‡ºæ‰€æ–™ï¼Œæˆ‘åœ¨node-thunkifyçš„issueåˆ—è¡¨ä¸­ä¹Ÿæ‰¾åˆ°äº†è·Ÿæˆ‘æœ‰ç€ç›¸å…³ç–‘é—®çš„åŒå­¦æå‡ºçš„ä¸€ä¸ª<a href="https://github.com/tj/node-thunkify/issues/13" target="_blank" rel="external">issue</a>ã€‚ç„¶åç»è¿‡æˆ‘ä¸€ç•ªèµ„æ–™çš„æŸ¥é˜…æ‰çŸ¥é“ï¼ŒåŸæ¥è¿™é‡Œè¿˜æœ‰è¿™ä¹ˆå¤šçš„é—¨é—¨é“é“ã€‚</p>
<p>é¦–å…ˆé€šè¿‡githubçš„issueï¼Œæˆ‘åœ¨stackoverlfowä¸Šæ‰¾åˆ°äº†ä¸€äº›ç›¸å…³çš„é—®é¢˜ï¼Œæ¯”å¦‚<a href="http://stackoverflow.com/questions/23509312/does-node-js-really-not-optimize-calls-to-slice-callarguments" target="_blank" rel="external">è¿™ä¸ª</a>ã€‚é¢˜ä¸»è¿™ä¸ªé—®é¢˜çš„æœ¬æ„æ˜¯æƒ³é—®â€œéš¾é“Node.jsçœŸçš„æ²¡æœ‰å¯¹<code>[].slice.call(arguments)</code>ä½œä»»ä½•çš„ä¼˜åŒ–æ“ä½œä¹ˆï¼Ÿâ€</p>
<p>è¿™ä¸ªé—®é¢˜ä¸­å¼•å‡ºäº†å‡ ä¸ªå…¶ä»–çš„é—®é¢˜ï¼Œ</p>
<ul>
<li>Node.jsçš„V8å¼•æ“ä¼šå¯¹ä¸€äº›è¢«ç§°ä¹‹ä¸ºâ€œhot functionâ€çš„ä»£ç å—è¿›è¡Œä¼˜åŒ–</li>
<li>æœ‰ä¸€äº›ä»£ç çš„å†™æ³•ä¼šå¯¼è‡´V8æ— æ³•è¿›è¡Œä¼˜åŒ–</li>
<li>å½“æ“ä½œ<code>arguments</code>å¯¹è±¡æ—¶ï¼Œéœ€è¦é¢å¤–çš„æ³¨æ„ï¼Œå› ä¸ºç¨ä¸æ³¨æ„å°±ä¼šå¯¼è‡´V8æ— æ³•ä¼˜åŒ–</li>
</ul>
<p>Node.jsä»£ç åº“çš„æ ¸å¿ƒå¼€å‘è€…<a href="https://github.com/isaacs" target="_blank" rel="external">isaacs</a>ä¸ºæ­¤å†™äº†ä¸€ç¯‡<a href="http://blog.izs.me/post/7746314700/benchmark-array-ification-of-arguments" target="_blank" rel="external">æ–‡ç« </a>ï¼Œè¯¦ç»†è¯´æ˜äº†åœ¨Node.jsä¸­åº”è¯¥å¦‚ä½•å°†ç±»æ•°ç»„å¯¹è±¡<code>arguments</code>å¤„ç†æˆä¸€ä¸ªçœŸæ­£çš„æ•°ç»„ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« æ€»ç»“ä¸‹æ¥ï¼Œå°±æ˜¯ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼Œ</p>
<ul>
<li>å¦‚æœå‡½æ•°çš„å‚æ•°ä¸ç¡®å®šï¼ˆæ•°é‡åŠç±»å‹ï¼‰ï¼Œé‚£ä¹ˆä¸æ¨èä½ å®šä¹‰ä»»ä½•çš„å½¢å¼å‚æ•°ã€‚</li>
<li>å¦‚æœæƒ³ä»<code>arguments</code>ä¸­å–å‡ºå‚æ•°ã€‚é‚£ä¹ˆæ¨èä½ æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼æ¥åšã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">varArgsList</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="built_in">arguments</span>.length === <span class="number">1</span> ? [<span class="built_in">arguments</span>[<span class="number">0</span>]] : <span class="built_in">Array</span>.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="comment">// now args is a array</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä½ å¯èƒ½æƒ³è¦è·å–é™¤äº†ç¬¬ä¸€ä¸ªå‚æ•°ä¹‹åçš„æ‰€æœ‰å‚æ•°ï¼ˆè¿™ç§æƒ…å†µå¸¸åœ¨å‘½ä»¤è¡Œå·¥å…·ä¸­é‡åˆ°ï¼‰ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">manualMap</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> l = <span class="built_in">arguments</span>.length;</span><br><span class="line">    <span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(l - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; l; i ++) &#123;</span><br><span class="line">        arr[i - <span class="number">1</span>] = <span class="built_in">arguments</span>[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ï¼ŒNode.jsçš„ä»£ç åº“ä¸­ä¹Ÿæœ‰å…³äºè¿™æ–¹é¢çš„<a href="https://github.com/nodejs/node-v0.x-archive/commit/91f1b250ecb4fb8151cd17423dd4460652d0ce97" target="_blank" rel="external">æ”¹åŠ¨</a>ï¼Œä¸»è¦æ˜¯å°†<code>EventEmitter.prototype.emit</code>ä¸­æŠ½å–<code>arguments</code>çš„å®ç°æ–¹å¼æ”¹å˜äº†ã€‚å› ä¸º<code>EventEmitter</code>æ¨¡å—å¯ä»¥è¯´æ˜¯Node.jsä¸­æœ€é‡è¦çš„æ¨¡å—ä¹‹ä¸€ï¼Œæ˜¯æ‰€æœ‰äº‹ä»¶é©±åŠ¨è§£å†³æ–¹æ¡ˆçš„åŸºçŸ³ï¼Œæ— ç–‘<code>EventEmitter</code>å°±æ˜¯æ‰€è°“çš„â€œhot functionâ€ã€‚</p>
<p><a href="http://jsperf.com/213213213" target="_blank" rel="external">è¿™é‡Œ</a>æ˜¯ä¸€äº›ç›¸å…³çš„benchmarkã€‚</p>
<p><a href="https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#3-managing-arguments" target="_blank" rel="external">BlueBirdçš„æ–‡æ¡£</a>ä¸­æåˆ°äº†ä¸€äº›å®‰å…¨ä½¿ç”¨<code>arguments</code>çš„å°tipsï¼Œæˆ‘è§‰å¾—å¾ˆæœ‰æ„ä¹‰ã€‚åœ¨ä½¿ç”¨<code>arguments</code>æ—¶æˆ‘ä»¬åº”è¯¥<strong>ä»…ä»…åª</strong>ä»ä¸‹é¢è¿™å‡ ä¸ªæ–¹é¢åˆ‡å…¥ï¼Œ</p>
<ul>
<li>å¯ä»¥ä½¿ç”¨<code>arguments.length</code></li>
<li>å¯ä»¥ä½¿ç”¨<code>arguments[i]</code>ï¼Œä½†æ˜¯<code>i</code>å¿…é¡»æ˜¯æ•°å­—ï¼Œä¸”ä¸èƒ½è¶…è¿‡è¾¹ç•Œ</li>
<li>é™¤äº†<code>arguments.length</code>å’Œ<code>arguments[i]</code>è¿™ä¸¤ç§å½¢å¼å¤–ï¼Œä¸è¦ä»¥å…¶ä»–ä»»ä½•å½¢å¼ä½¿ç”¨<code>arguments</code></li>
<li>ä¸¥æ ¼è¦æ±‚ï¼Œ<code>fn.apply(y, arguments)</code>ï¼ˆ<code>Function#apply</code>è¿™ç§å½¢å¼éƒ½æ˜¯okçš„ï¼‰æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯å…¶ä»–çš„å½¢å¼éƒ½æ˜¯ä¸æ¨èçš„ï¼Œæ¯”å¦‚<code>.slice</code></li>
</ul>
<p>æœ€åï¼Œå…¶å®æˆ‘æƒ³è¯´ï¼Œå…³äºè¿™ä¸ª<code>arguments</code>æ‰€è°“çš„æ€§èƒ½ï¼Œå¯èƒ½åœ¨ç»ä¸å¤šæ•°åœºæ™¯ä¸‹ï¼Œéƒ½ä¸ä¼šæˆä¸ºç“¶é¢ˆã€‚é™¤éä½ çš„æŸä¸€ä¸ªåŠŸèƒ½æ¨¡å—æˆ–è€…ä¸šåŠ¡æ¨¡å—æ‰¿æ‹…ç€ä¸Šäº¿çº§åˆ«çš„ops/sï¼Œå¦åˆ™è¿™ç§å¾®å°çš„æå‡å¸¦æ¥çš„æ”¶ç›ŠåŸºæœ¬ä¸Šå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä¸è¿‡è¯è¯´å›æ¥ï¼Œè¿™ä¸ªä½œä¸ºä¸šåŠ¡çŸ¥è¯†çš„æ‰©å±•å€’æ˜¯ä¸ªä¸é”™çš„é—¨è·¯ã€‚è€Œä¸”ï¼Œè¯´ä¸å‡†éšç€æ—¥åV8å¼•æ“çš„æ›´æ–°ï¼Œå®ƒä¼šè¶Šæ¥è¶Šæ™ºèƒ½ï¼Œè‡ªåŠ¨å°†è¿™äº›é—®é¢˜å†…ç½®è§£å†³äº†å‘¢ï¼Ÿä½ è¯´å¯¹å§ï¼ŸğŸ˜‚ğŸ˜‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul>
<li><a href="http://blog.izs.me/post/7746314700/benchmark-array-ification-of-arguments" target="_blank" rel="external">Benchmark: Array-ification of arguments</a></li>
<li><a href="https://github.com/tj/node-thunkify/pull/12" target="_blank" rel="external">node-thunkify/pull/12</a></li>
<li><a href="http://stackoverflow.com/questions/23509312/does-node-js-really-not-optimize-calls-to-slice-callarguments" target="_blank" rel="external">stackoverflow question</a></li>
</ul>


            <div class="post-info">
    <p class="eof">- EOF -</p>
    <p class="copyright">All rights reserved <a href="http://gejiawen.github.io/about">@gejiawen</a>.</p>
    <p class="link">æœ¬æ–‡é“¾æ¥ï¼š<a href="http://blog.gejiawen.com/2015/11/04/perf-about-array-prototype-slice-arguments/">http://blog.gejiawen.com/2015/11/04/perf-about-array-prototype-slice-arguments/</a></p>

    <div class="share">
    åˆ†äº«æœ¬é¡µï¼š
    
        <div class="bdsharebuttonbox"><a href="#" class="bds_weixin" data-cmd="weixin" title="åˆ†äº«åˆ°å¾®ä¿¡">å¾®ä¿¡</a><a href="#" class="bds_qzone" data-cmd="qzone" title="åˆ†äº«åˆ°QQç©ºé—´">QQç©ºé—´</a><a href="#" class="bds_tsina" data-cmd="tsina" title="åˆ†äº«åˆ°æ–°æµªå¾®åš">æ–°æµªå¾®åš</a><a href="#" class="bds_tqq" data-cmd="tqq" title="åˆ†äº«åˆ°è…¾è®¯å¾®åš">è…¾è®¯å¾®åš</a><a href="#" class="bds_more" data-cmd="more"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

    
    
</div>

</div>


            
    <section class="comment">
    <div class="ds-thread" data-thread-key="perf-about-array-prototype-slice-arguments" data-title="Array.prototype.slice(arguments)çš„çŒ«è…»" data-url="http://blog.gejiawen.com/2015/11/04/perf-about-array-prototype-slice-arguments/" data-author-key="gejiawen"></div>
</section>


<script type="text/javascript">
var duoshuoQuery = {short_name:"gejiawen-blog"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';
        ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>





        </div>
    </div>
</article>

    <footer id="footer">
        <div id="bottom-tip">
            è›‹ç³•ä»™äºº â€”â€” <small>æŠ€æœ¯äººéœ€è¦å±æœºæ„Ÿ</small>
        </div>
        <small>è¯¥åšå®¢ç”± <a href="https://hexo.io/" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ï¼Œæ­è½½ <a href="https://github.com/gejiawen/hexadillax2" target="_blank">Hexadillax2</a> ä¸»é¢˜</small><br />
        <!--<small>å¦‚æœä½ è®¿é—®githubé€Ÿåº¦è¿‡æ…¢ï¼Œå¯ç§»æ­¥æœ¬ç«™çš„å¤‡ä»½ç«™ç‚¹<a href="http://gejiawen.gitcafe.io">gejiawen.gitcafe.io</a></small><br />-->
        <small>&copy; 2017 <a href="http://blog.gejiawen.com" target="_blank">gejiawen</a>&nbsp;<a href="http://www.miitbeian.gov.cn/" target="_blank">çš–ICPå¤‡16008778å·</a></small>
    </footer>
    
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e4dd778a6204eb51e4f25460e37481ad";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


    <script type="text/javascript" src="http://tajs.qq.com/stats?sId=58628762" charset="UTF-8"></script>


    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-51347904-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>

